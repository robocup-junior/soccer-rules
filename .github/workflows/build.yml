on: [push]
jobs:
  build:
    name: build
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: 'common'

      - name: build the rules
        run: |
          git submodule init
          git submodule update
          ls common
          cd common
          git status
          cd ..
          mkdir -p dist/${GITHUB_REF#refs/heads/}/
          ./common/ci/000_build_rules.sh rules.adoc
          cp -R build/results/rules_html/* build/results/rules.pdf dist/${GITHUB_REF#refs/heads/}/
          ./common/ci/000_build_rules.sh superteam_rules.adoc
          cp -R build/results/superteam_rules_html/* build/results/superteam_rules.pdf dist/${GITHUB_REF#refs/heads/}/

      - name: publish the rules
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN  }}
          publish_dir: ./dist
          keep_files: True
